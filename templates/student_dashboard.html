{% extends 'base.html' %}
{% load static %}

{% block content %}

<link rel="stylesheet" href="{% static 'css/student_dashboard.css' %}?v=2">
<script>
const searchInput = document.getElementById("domainSearch");
const alumniCards = document.querySelectorAll(".alumni-card");

searchInput.addEventListener("input", function () {
    const query = searchInput.value.trim().toLowerCase();

    alumniCards.forEach(card => {
        const domains = card.dataset.domain || "";

        // ‚úÖ If input empty ‚Üí show all
        if (query === "") {
            card.style.display = "block";
            return;
        }

        // ‚úÖ Split domain into array (comma / pipe / space safe)
        const domainArray = domains
            .split(/,|\||\//)
            .map(d => d.trim());

        // ‚úÖ Check if query exists in any domain item
        const match = domainArray.some(domain =>
            domain.includes(query)
        );

        card.style.display = match ? "block" : "none";
    });
});
</script>

<h2 class="page-title">Find Alumni Mentors</h2>

<input 
    type="text" 
    id="domainSearch"
    placeholder="Search by domain (Web, AI, ML)"
    class="domain-search"
/>


{% for alumni in alumni_profiles %}
<div class="alumni-card"
     data-domain="{{ alumni.alumniprofile.domain|lower }}">

     
    <!-- HEADER -->
    <div class="alumni-header">
        <h3>{{ alumni.user.username }}</h3>
        {% if alumni.alumniprofile.available_for_mentorship %}
            <span class="badge available">Available</span>
        {% else %}
            <span class="badge unavailable">Unavailable</span>
        {% endif %}
    </div>

    <!-- DETAILS -->
    {% if alumni.alumniprofile %}
    <div class="alumni-details">
        <p><strong>Company:</strong> {{ alumni.alumniprofile.company_name|default:"‚Äî" }}</p>
        <p><strong>Role:</strong> {{ alumni.alumniprofile.current_role|default:"‚Äî" }}</p>
        <p><strong> Key Domain:</strong> {{ alumni.alumniprofile.domain|default:"‚Äî" }}</p>

        {% if alumni.alumniprofile.experience_years %}
            <p><strong>Experience:</strong> {{ alumni.alumniprofile.experience_years }} years</p>
        {% endif %}

        {% if alumni.alumniprofile.expertise %}
            <p><strong>Expertise:</strong> {{ alumni.alumniprofile.expertise }}</p>
        {% endif %}
    </div>
    {% endif %}

    <hr>

    <!-- ACTIONS -->
    <div class="actions">

        <a href="{% url 'view_profile' alumni.user.id %}" class="link">
            üë§ View Profile
        </a>

        {% if alumni.request_status == 'pending' %}
            <span class="status pending">‚è≥ Request Pending</span>

        {% elif alumni.request_status == 'accepted' %}
            <span class="status accepted">‚úÖ Accepted</span>

        {% elif alumni.request_status == 'declined' %}
            <span class="status accepted">‚úñ Declined</span>

        {% else %}
            {% if alumni.alumniprofile.available_for_mentorship %}
               <a href="{% url 'send_mentorship_request' alumni.user.id %}" class="link">
    ü§ù Request Mentorship
</a>

            {% else %}
                <span class="status disabled">Not accepting requests</span>
            {% endif %}
        {% endif %}
    </div>

</div>
{% empty %}
<p class="empty">No alumni available.</p>
{% endfor %}

{% endblock %}
